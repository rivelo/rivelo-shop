<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Виписка по клієнту: {{client_name.name}}</title>


    <link rel="stylesheet" type="text/css" href="/media/table.css">
{#    <script type="text/javascript" src="/media/jquery-1.7.2.min.js"></script> #}
	<link rel="stylesheet" type="text/css" href="/media/jquery-ui-1.9.2.custom.css">	

	<script type="text/javascript" src="/media/jquery-1.8.3.js"></script>	
	<script type="text/javascript" src="/media/jquery-ui-1.9.2.custom.min.js"></script>

<style type="text/css">
#button > span.ui-icon-custom { 
    background-image: url(/media/images/Bicycle_ico.png)    
}
</style>

{% load poll_extras %}     
    
<script language="JavaScript">
$(document).ready(function() {
	$( document ).tooltip();
	$( "#dialog" ).hide();
	
	$( "#img_repair" ).click(function() {
      $( "#dialog_r" ).dialog({ autoOpen: true });
  	});
	
})


$(function() {
    $( "button:first" ).button({
      icons: {
        primary: "ui-icon-custom"
      },
      text: false
    })
	.click(function() {
        alert( "Running the last action" );
    })
    .next().button({
      icons: {
        primary: "ui-icon-custom"
      }
    })
	.click(function() {
		$( "#dialog" ).dialog();
        //alert( "Running the last action" );
    })    
    .next().button({
      icons: {
        primary: "ui-icon-locked"
      }
    })
    .next().button({
      icons: {
        primary: "ui-icon-locked"
      }
    })
	.click(function() {
		$( "#dialog" ).dialog();
        //alert( "Running the last action" );
    });
});


function res()
{
var p=0;
var All=document.forms['formSum'];
for(var i = 0; i < All.elements.length; ++i) {
	if(All.elements[i].checked){
	//p+=parseInt(All.elements[i].value);
	p=p+parseFloat(All.elements[i].value);
	}
	document.getElementById('for_pay').innerHTML = p.toFixed(2)+" грн.";
	document.getElementById('debet').innerHTML = parseFloat(document.getElementById('for_pay').innerHTML)+parseFloat(document.getElementById('workshop_pay').innerHTML);
}
}
    
function resWorkshop()
{
var p=0;
var All=document.forms['formWorkshopSum'];
for(var i = 0; i < All.elements.length; ++i) {
	if(All.elements[i].checked){
	p+=parseFloat(All.elements[i].value);
	}
	document.getElementById('workshop_pay').innerHTML = p.toFixed(2)+" грн.";
	document.getElementById('debet').innerHTML = parseFloat(document.getElementById('for_pay').innerHTML)+parseFloat(document.getElementById('workshop_pay').innerHTML);
}
}


$(function() {
    $( "#tabs" ).tabs({
      beforeLoad: function( event, ui ) {
        ui.jqXHR.error(function() {
          ui.panel.html(
            "Couldn't load this tab. We'll try to fix this as soon as possible. " +
            "If this wouldn't be a demo." );
        });
      }
    });

        $("#all_cred").click(function(){
            var Id = 2 
            $.ajax({
                type: "POST",
                url: "/client_history/",
                data: { clientId: Id },
                dataType: "json",
                success:function(msg){
                	$.each(msg,function(index,item){
                	    $('.in_cred').after('<tr><td>'+ item.fields.date +'</td><td>'+ item.fields.description +'</td><td>' + item.fields.price+'</td></tr>');
//                        tr = '<tr><td>'+ item.fields.date+'</td>';
//                        tr += '<td>' + item.fields.description+'</td>';
//                        tr += '<td>' + item.fields.price+'</td>';
//                        tr += '</tr>';
//                        $('#balance').children('tbody').append(tr);
                    });
//					$('#balance').append('<tr><td>00/00/0000</td><td>'+ msg[0].description +'</td><td></td></tr>');
//					$('.in_cred').after('<tr><td>00/00/0000</td><td>'+ msg[1].fields.description +'</td><td></td></tr>');
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                }
            });      
		});

       
});

$(function() {
    $( "#dialog_r" ).dialog({ autoOpen: false });
  });
  
         
</script>

<body onLoad="res(); resWorkshop()">

<div style=" margin: 10px 0px 0px 0px;
    width: 800px;      
    float:left;  ">
    <h1>Виписка по клієнту:
    <span title="Телефон: {{client_name.phone|phone2Str}} <br> E-mail: {{client_name.email}}">
    	 <a href=/client/edit/{{client_name.id}}> {{client_name.name}} ({{client_name.forumname}}) </a>
    </span>
    </h1>
</div>

<!-- repair bike  -->
<img style="display: none;" id="img_repair" src="http://thumb10.shutterstock.com/thumb_small/295516/103760093/stock-photo-bicycle-repair-sign-on-a-white-background-part-of-a-series-103760093.jpg" height="64px" >

<div id="dialog_r" title="Заявки на ремонт:">
<table>
{% for ticket in workshop  %}
{% if ticket.status__name = 'Прийнято' %}
  <tr bgcolor="#CCFF99" > 
  <script>
  $('#img_repair').show();
  </script>
{% else %}
  <tr bgcolor="#FFFFFF">
{% endif %}  
  <td>{{ticket.date}}</td><td>{{ticket.description}}</td><td>{{ticket.status__name}}</td>
  </tr>
{% endfor %}
</table>
</div>

<div style="float: right;   
  margin: 10px 0px 0px 0px;  
  text-align: right;  ">
<button id="button">Button with icon only</button>
{% for bike in b_bike %}
<button>{{bike.model__model__model}} - {{bike.date}}</button>
{% endfor %}
</div>

<div id="dialog" title="Придбані велосипеди">
{% for bike in b_bike %}
<p><b>Велосипед {{bike.model__model__brand__name}} {{bike.model__model__model}} {{bike.model__size__name}}</b> S/N: [{{bike.model__serial_number}}] <br> Дата продажу: {{bike.date}} <br> Сервіс: {{bike.service|default:"Не пройдено"}}</p>
{% endfor %}  
</div>	
   
    

    <div style="clear:both;">
	<br>
	 <h2 style="color:red;"> Cума:  {{clients|floatformat:2}} грн.
	 </h2>	
	
	</div>

	
	
<table id="balance" >
	<tr><th>Дата</th>
	<th>Опис</th>
	<th>Сума (грн)</th>
	</tr>
	
	<tr BGCOLOR="#29AE48"  class="in_cred">
	<td>
	Оплати
	</td>
	<td><a href="/clientcredits/add/{{client_name.id}}">Створити нову проплату</a>  
	{% if perms.accounting.delete_clientcredits %}
	 /-----/ <a href="/clientcredits/{{client_name.id}}/delete/all">(Видалити всі проплати)</a> 
	 /-----/ <a id="all_cred" href="javascript:">(Показати всі проплати)</a>
	{% endif %}	
	 
	</td>
	<td>
	</td>
	</tr>
	
	
	{% for credit in credit_list %}
	<tr>
	<td>
		<abbr title="{{credit.date|time:"H:i"}} - [{{credit.user.username}}]">
	{{credit.date|date}}
	</abbr>
	</td>
	<td>
	{{credit.description}} 
	{% if perms.accounting.delete_clientcredits %}
	<a href="/clientcredits/edit/{{ credit.id }}">edit</a>	 
	<a href="/clientcredits/delete/{{ credit.id }}" onclick="return confirm('Видалити запис?')">delete</a>
	{% endif %}
	</td>
	<td>
	{{credit.price}}
	</td>
	{% endfor %}
	</tr>

	<tr BGCOLOR="#F11111">
	<td>
	Борги
	</td>
	<td><a href=/clientdebts/add/{{client_name.id}}> Додати борг </a>
	{% if perms.accounting.delete_clientcredits %}
	 /-----/ <a href="/clientdebts/{{client_name.id}}/delete/all">(Видалити всі борги)</a> 
	{% endif %}	
	</td>
	<td id="debet">
	</td>
	</tr>

	{% for debt in debt_list %}
	<tr>
	<td>
	<abbr title="{{debt.date|time:"H:i"}} - [{{debt.user.username}}]">
	{{debt.date|date}}
	</abbr>
	</td>
	<td>
	{{debt.description}}
	{% if perms.accounting.delete_preorder %}
    <a href="/clientdebts/edit/{{ debt.id }}" >edit</a>	
    <a href="/clientdebts/delete/{{ debt.id }}" onclick="return confirm('Видалити запис?')">delete</a>	
	{% endif %}
	</td>
	<td>
	{{debt.price}}
	</td>
	{% endfor %}
	</tr>
	
	</table>

<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Товари</a></li>
    <li><a href="/client/{{client_name.id}}/invoice/lookup/">Проданий товар</a></li>
    <li><a href="//content3-slow.php">Виконані роботи</a></li>
    <li><a href="#tabs-2">Майстерня</a></li>
  </ul>
  <div id="tabs-1">
{# Проданий Товар #}	
<form action="/payform/" method="post" name="formSum">
	<br>
	<table id="product">
	<tr bgcolor="grey">
	<th>Дата</th>
	<th>Товар</th>
	<th>Кількість</th>
	<th>Прайс</th>
	<th>Сума</th>
	<th>Оплата</th>
	<th>Валюта</th>
	<th>Оплата</th>
	</tr>
	
	{% for inv in invoice %}
	<tr>
	<td>
	{{inv.date}}
	</td>
	<td>
	{{inv.catalog}}
	</td>
	<td>
	{{inv.count}}
	</td>
	<td>
	{{inv.price}}
	</td>
	<td>
	{{inv.sum}}
	</td>
	
{% ifequal inv.sum inv.pay %}
<td>
	{{inv.pay}}
	</td>	
	<td>
	{{inv.currency}}
	</td>
	<td align="center">
	<input type="checkbox" id="model{{forloop.counter}}" value="{{inv.sum}}" onclick="res()" name="checkbox_{{ inv.id }}"/>
	</td>
{% else %}
	<td BGCOLOR="#FF6600">
	{{inv.pay}}
	</td>	
	<td>
	{{inv.currency}}
	</td>
	<td align="center">
	<input type="checkbox" id="model{{forloop.counter}}" value="{{inv.sum}}" onclick="res()" checked name="checkbox_{{ inv.id }}"/>
	</td>
{% endifequal %}
	</tr>
	{% endfor %}
	
	<tr>
	<th></th>
	<th></th>
	<th></th>
	<th>Загальна сума</th>
	<th>{{client_invoice_sum}} грн.</th>
	<th><p><input type="submit" value="Оплата" name="pay"></p>
	<input type="submit" value="E-mail" name="send_check"></th>
	<th BGCOLOR="#D5FFB4">До оплати</th>
	<th id="for_pay" BGCOLOR="#D5FFB4">0</th>
	</tr>
	</table>
</form>	

  </div>

<div id="tabs-2">
{# Роботи майстерні #}
<form action="/payform/workshop/" method="post" name="formWorkshopSum" >
<br>
	<table border=1 width="100%" style="font-size : 12px; font-family : Arial;">
	<tr bgcolor="grey">
	<th>Дата</th>
	<th>Робота</th>
	<th>Прайс</th>
	<th>Опис</th>
	<th>Оплата</th>
	</tr>
	
	{% for inv in workshop %}
	<tr>
	<td>
	{{inv.date}}
	</td>
	<td>
	{{inv.work_type}}
	</td>
{% if inv.pay %}	
	<td>
	{{inv.price}}
	</td>
	<td>
	{{inv.description}}
	</td>	
	<td align="center">
	<input type="checkbox" id="model_workshop{{forloop.counter}}" value="{{inv.price}}" onclick="resWorkshop()" name="checkbox_{{ inv.id }}"/>
	</td>	
{% else %}
	<td BGCOLOR="#FF6600">
	{{inv.price}}
	</td>
	<td>
	{{inv.description}}
	</td>	
	<td align="center">
	<input type="checkbox" id="model_workshop{{forloop.counter}}" value="{{inv.price}}" onclick="resWorkshop()" checked name="checkbox_{{ inv.id }}"/>
	</td>
{% endif %}
	</tr>
	{% endfor %}
	
	<tr>
	<th></th>
	<th>Загальна сума</th>
	<th>{{client_workshop_sum}} грн.</th>
	<th BGCOLOR="#D5FFB4">
	<p><input type="submit" value="Оплата" name="pay" onClick="return confirm('Провести операцію?')"></p>
	<input type="submit" value="E-mail" name="send_check">	
	</th>
	<th><p>До оплати:</p><p id="workshop_pay" BGCOLOR="#D5FFB4">0<p></th>
	</tr>
	</table>
</form>
	</div>
</div>


<a href=/workticket/add/client/{{client_name.id}}/> 
Створити заявку на ремонт
</a>
<br>
<a href=/workshop/add/client/{{client_name.id}}/> 
Додати роботу
</a>
<br>	
<br>
<a href=/client/search/> Пошук клієнта </a>
 



